1. Adding dependencies when creating the package

ros2 pkg create \
  --build-type ament_python \
  --license Apache-2.0 \
  self_driving_car \
  --dependencies rclpy geometry_msgs webots_ros2_driver sensor_msgs std_msgs rosgraph_msgs 

2. Then manually add the missing dependencies in package.xml

<exec_depend>cv_bridge</exec_depend>
<exec_depend>ros2_numpy</exec_depend>
<exec_depend>numpy</exec_depend>
<exec_depend>controller</exec_depend>  <!-- For Webots Supervisor -->

3. Add Python imports normally inside your scripts


ros2 pkg create \
  --build-type ament_python \
  --license Apache-2.0 \
  utils \
  --dependencies rclpy geometry_msgs webots_ros2_driver sensor_msgs std_msgs rosgraph_msgs 

colcon build --packages-select simple

source install/setup.bash

pip install lark-parser lark PyYAML 
pip install lark
python3 -m pip install PyYAML
pip install catkin_pkg

cd ~/source_code/self-driving-car-ROS2/ros2_ws/src
git clone https://github.com/Box-Robotics/ros2_numpy.git -b jazzy

colcon build
source install/setup.bash

source install/setup.bash
ros2 launch self_driving_car reference.py max_speed:=30

pip install empy
git clone https://github.com/cyberbotics/webots_ros2.git
colcon build 
source install/setup.bash



tree -L 4 src/webots_ros2*

sudo apt install ros-${ROS_DISTRO}-radar-msgs
pip install empy lark-parser setuptools colcon-common-extensions catkin_pkg rosdep pandas scikit-learn numpy python3-pandas python3-sklearn python3-numpy python3-scipy
pip install lark-parser
pip install setuptools
pip install colcon-common-extensions
pip install catkin_pkg
pip install rosdep
pip install pandas
pip install scikit-learn
pip install numpy
sudo apt install python3-pandas python3-sklearn python3-numpy python3-scipy

# Install system wide
sudo apt update
sudo apt install python3-empy python3-lark-parser python3-setuptools \
                 python3-colcon-common-extensions python3-catkin-pkg \
                 python3-rosdep

# Try apt first
sudo apt install python3-pandas python3-sklearn python3-numpy

# If versions are too old or not available, use pip with --break-system-packages
sudo pip install --break-system-packages pandas scikit-learn numpy 

Ésto funcionó:

mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
git clone -b jazzy https://github.com/cyberbotics/webots_ros2.git
cd ~/ros2_ws
colcon build
echo "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc

##################################################################33

WARNING: DEF BMW_X5 BmwX5 > Camera "camera": As 'physics' is set to NULL, collisions will have no effect.
WARNING: DEF BMW_X5 BmwX5 > VelodyneHDL-64E "Velodyne HDL-64E": As 'physics' is set to NULL, collisions will have no effect.
WARNING: DEF BMW_X5 BmwX5: The controller directory has not been found, searched the following locations:
//controllers/bmw_x5_controller/
/usr/local/webots/projects/vehicles/controllers/bmw_x5_controller/
/usr/local/webots/projects/default/controllers/bmw_x5_controller/
/usr/local/webots/resources/projects/controllers/bmw_x5_controller/
WARNING: DEF vehicle_opposite_autonomous_1 CitroenCZero: The controller directory has not been found, searched the following locations:
//controllers/supervisor_opposite_autonomous_1/
/usr/local/webots/projects/vehicles/controllers/supervisor_opposite_autonomous_1/
/usr/local/webots/projects/default/controllers/supervisor_opposite_autonomous_1/
/usr/local/webots/resources/projects/controllers/supervisor_opposite_autonomous_1/
WARNING: Robot "robot": The controller directory has not been found, searched the following locations:
//controllers/supervisor/
/usr/local/webots/projects/default/controllers/supervisor/
/usr/local/webots/resources/projects/controllers/supervisor/
WARNING: bmw_x5_controller: Could not find the controller directory.
Starting the <generic> controller instead.

# Copiar controladores a donde los pueda encontrar Webots:
sudo cp -r src/self_driving_car/controllers/bmw_x5_controller/ /usr/local/webots/projects/vehicles/controllers/

sudo cp -r src/self_driving_car/controllers/supervisor_opposite_autonomous_1/ /usr/local/webots/projects/vehicles/controllers/

sudo cp -r src/self_driving_car/controllers/supervisor/ /usr/local/webots/projects/default/controllers/supervisor/

Clean rebuild:

# Navigate to your workspace
cd ~/source_code/self-driving-car-ROS2/ros2_ws

# 1. REMOVE ALL BUILD ARTIFACTS
rm -rf build/ install/ log/

# 2. Also clean ROS2 cache (optional but thorough)
rm -rf ~/.ros/log/

# 3. Rebuild from scratch
colcon build --packages-select self_driving_car --symlink-install

# 4. Source the new setup
source install/setup.bash

#######################################################

mkdir -p ~/rviz_configs
cat > ~/rviz_configs/lidar_debug.rviz << 'EOF'
Panels:
  - Class: rviz_common/Displays
    Name: Displays
  - Class: rviz_common/Views
    Name: Views
Visualization Manager:
  Displays:
    - Class: rviz_default_plugins/Grid
      Enabled: true
      Name: Grid
      Plane Cell Count: 10
      Reference Frame: <Fixed Frame>
      Value: true
    - Class: rviz_default_plugins/TF
      Enabled: true
      Name: TF
      Marker Scale: 0.3
      Show Arrows: true
      Show Names: true
    - Class: rviz_default_plugins/PointCloud2
      Enabled: true
      Name: PointCloud
      Topic: /point_cloud
      Selectable: true
      Size (Pixels): 3
      Style: Points
      Value: true
      Alpha: 0.8
      Color Transformer: AxisColor
      Position Transformer: XYZ
      Axis: Z
      Use Fixed Frame: true
      Use rainbow: true
  Enabled: true
  Global Options:
    Background Color: 48; 48; 48
    Fixed Frame: base_link
    Frame Rate: 30
  Name: root
  Tools:
    - Class: rviz_default_plugins/Interact
      Hide Inactive Objects: true
    - Class: rviz_default_plugins/MoveCamera
    - Class: rviz_default_plugins/Select
    - Class: rviz_default_plugins/FocusCamera
    - Class: rviz_default_plugins/Measure
      Line color: 128; 128; 0
  Value: true
  Views:
    Current:
      Class: rviz_default_plugins/Orbit
      Name: Current View
      Target Frame: base_link
      Value: Orbit (rviz)
    Saved: ~
EOF



rviz2 \
  -d ~/rviz_configs/lidar_debug.rviz \
  --display-config ~/rviz_configs/lidar_debug.rviz
  
  rviz2 -d ~/rviz_configs/lidar_debug.rviz
  
  colcon build --packages-select simple

