<?xml version="1.0"?>
<launch
    xmlns="http://ros.org/schema/launch"
    xmlns:arg="http://ros.org/schema/launch/arg"
    xmlns:param="http://ros.org/schema/launch/param">

  <!-- Arguments -->
  <arg name="max_speed" default="20"/>
  <arg name="k_following" default="10"/>
  <arg name="dist_to_car" default="20"/>
  <arg name="goal_dist" default="200"/>
  <arg name="no_gui" default="false"/>

  <!-- Environment variable -->
  <set_env name="WEBOTS_HOME" value="/usr/local/webots"/>

  <!-- Include Webots ROS2 launcher -->
  <include file="$(find-pkg-share webots_ros2_driver)/launch/webots.launch.py">
    <arg name="mode" value="realtime"/>
    <arg name="no_gui" value="$(var no_gui)"/>
    <arg name="world" value="$(find-pkg-share self_driving_car)/worlds/reference.wbt"/>
  </include>

  <!-- Nodes -->
  <executable pkg="self_driving_car" exec="lane_detector_canny_hough.py" output="screen"/>
  <executable pkg="self_driving_car" exec="obstacle_detector.py" output="screen"/>
  
  <executable pkg="self_driving_car" exec="behaviors.py" output="screen">
    <param name="max_speed" value="$(var max_speed)"/>
    <param name="k_following" value="$(var k_following)"/>
    <param name="dist_to_car" value="$(var dist_to_car)"/>
  </executable>

  <executable pkg="self_driving_car" exec="success.py" output="screen"/>
  <executable pkg="self_driving_car" exec="stop.py" output="screen"/>
  <executable pkg="self_driving_car" exec="lane_identification.py" output="screen"/>

  <!-- Static transforms -->
  <executable pkg="tf2_ros" exec="static_transform_publisher"
      args="0 0 2.0 0 0 0 car_link lidar_link"/>

  <executable pkg="tf2_ros" exec="static_transform_publisher"
      args="1.2 0 1.5 0 0 0 car_link camera_link"/>

  <executable pkg="tf2_ros" exec="static_transform_publisher"
      args="0 0 0.1 0 0 0 car_link gyro_link"/>

  <executable pkg="tf2_ros" exec="static_transform_publisher"
      args="0 0 0.1 0 0 0 car_link accel_link"/>

  <executable pkg="tf2_ros" exec="static_transform_publisher"
      args="0 0 0.1 0 0 0 car_link gps_link"/>

</launch>

